<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Form Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .content {
            padding: 40px;
        }
        
        .form-group {
            margin-bottom: 30px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
            font-size: 1.1rem;
        }
        
        .form-group textarea {
            width: 100%;
            min-height: 200px;
            padding: 20px;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            line-height: 1.6;
            resize: vertical;
            transition: all 0.3s ease;
        }
        
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .placeholder-hint {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            font-size: 14px;
            color: #6c757d;
        }
        
        .placeholder-hint strong {
            color: #495057;
        }
        
        .generate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            display: block;
            margin: 0 auto;
        }
        
        .generate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .status {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-weight: 500;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.processing {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .preview-section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #f1f3f4;
        }
        
        .preview-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .placeholders-list {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .placeholder-item {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            margin: 5px;
            font-size: 12px;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>PDF Form Generator</h1>
            <p>Transform text with placeholders into interactive PDF forms</p>
        </div>
        
        <div class="content">
            <div class="form-group">
                <label for="textInput">Enter your text with placeholders:</label>
                <textarea 
                    id="textInput" 
                    placeholder="Dear [Name],

Thank you for your application dated [Date]. We are pleased to inform you that your request for [Service] has been approved.

Your reference number is [Reference Number].

Please contact us at [Phone Number] if you have any questions.

Best regards,
[Sender Name]
[Title]"
                ></textarea>
                <div class="placeholder-hint">
                    <strong>Tip:</strong> Use square brackets to create form fields. For example: [Name], [Date], [Email], etc.<br>
                    <strong>Smart Fields:</strong> Fields like [Address], [Comments], [Description] become multiline boxes. Fields like [Name], [Email], [Phone Number] auto-expand as needed.
                </div>
            </div>
            
            <div class="preview-section" id="previewSection" style="display: none;">
                <h3>Detected Placeholders:</h3>
                <div class="placeholders-list" id="placeholdersList"></div>
            </div>
            
            <button class="generate-btn" id="generateBtn" onclick="generatePDF()">
                Generate PDF Form
            </button>
            
            <div class="status" id="status" style="display: none;"></div>
        </div>
    </div>

    <script>
        const textInput = document.getElementById('textInput');
        const previewSection = document.getElementById('previewSection');
        const placeholdersList = document.getElementById('placeholdersList');
        const generateBtn = document.getElementById('generateBtn');
        const status = document.getElementById('status');

        // Update preview when text changes
        textInput.addEventListener('input', updatePreview);

        function updatePreview() {
            const text = textInput.value.trim();
            const placeholders = extractPlaceholders(text);
            
            if (placeholders.length > 0) {
                previewSection.style.display = 'block';
                placeholdersList.innerHTML = placeholders.map(p => 
                    `<span class="placeholder-item">${p}</span>`
                ).join('');
            } else {
                previewSection.style.display = 'none';
            }
        }

        function extractPlaceholders(text) {
            const regex = /\[([^\]]+)\]/g;
            const placeholders = [];
            let match;
            
            while ((match = regex.exec(text)) !== null) {
                if (!placeholders.includes(match[1])) {
                    placeholders.push(match[1]);
                }
            }
            
            return placeholders;
        }

        function showStatus(message, type) {
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    status.style.display = 'none';
                }, 5000);
            }
        }

        async function generatePDF() {
            const text = textInput.value.trim();
            
            if (!text) {
                showStatus('Please enter some text first.', 'error');
                return;
            }

            const placeholders = extractPlaceholders(text);
            
            if (placeholders.length === 0) {
                showStatus('No placeholders found. Use [placeholder] format.', 'error');
                return;
            }

            generateBtn.disabled = true;
            showStatus('Generating PDF form...', 'processing');

            try {
                // Create a new PDF document
                const pdfDoc = await PDFLib.PDFDocument.create();
                
                // Add a page
                const page = pdfDoc.addPage([612, 792]); // US Letter size
                const { width, height } = page.getSize();
                
                // Set up fonts and styling
                const fontSize = 12;
                const lineHeight = fontSize * 1.5;
                const margin = 50;
                const maxWidth = width - (2 * margin);
                
                // Process the text and create form fields
                const lines = text.split('\n');
                let yPosition = height - margin - fontSize;
                let fieldCounter = 0;
                
                for (const line of lines) {
                    if (yPosition < margin + 50) {
                        // Add new page if we're running out of space
                        const newPage = pdfDoc.addPage([612, 792]);
                        yPosition = newPage.getSize().height - margin - fontSize;
                    }
                    
                    const processedLine = await processLineWithWrapping(line, page, pdfDoc, margin, yPosition, maxWidth, fieldCounter);
                    yPosition -= lineHeight;
                    fieldCounter = processedLine.fieldCounter;
                }

                // Add form instructions at the bottom
                const instructionPage = pdfDoc.addPage([612, 792]);
                const instructionY = instructionPage.getSize().height - margin - fontSize;
                
                instructionPage.drawText('Instructions:', {
                    x: margin,
                    y: instructionY,
                    size: 14,
                    color: PDFLib.rgb(0, 0, 0.8),
                });
                
                instructionPage.drawText('1. Click on the highlighted fields to edit them', {
                    x: margin,
                    y: instructionY - 25,
                    size: 11,
                    color: PDFLib.rgb(0.2, 0.2, 0.2),
                });
                
                instructionPage.drawText('2. Fill in all required information', {
                    x: margin,
                    y: instructionY - 45,
                    size: 11,
                    color: PDFLib.rgb(0.2, 0.2, 0.2),
                });
                
                instructionPage.drawText('3. Save the completed form', {
                    x: margin,
                    y: instructionY - 65,
                    size: 11,
                    color: PDFLib.rgb(0.2, 0.2, 0.2),
                });

                // Create the PDF form
                const form = pdfDoc.getForm();
                
                // Serialize the PDF
                const pdfBytes = await pdfDoc.save();
                
                // Create download link
                const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'editable-form.pdf';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showStatus(`PDF form generated successfully with ${placeholders.length} form fields!`, 'success');
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                showStatus('Error generating PDF. Please try again.', 'error');
            } finally {
                generateBtn.disabled = false;
            }
        }

        async function processLineWithWrapping(line, page, pdfDoc, x, y, maxWidth, fieldCounter, lineHeight) {
            const form = pdfDoc.getForm();
            const fontSize = 12;
            let currentX = x;
            let currentY = y;
            let currentFieldCounter = fieldCounter;
            let currentPage = page;
            
            // Split line by placeholders and spaces for better wrapping
            const parts = line.split(/(\[[^\]]+\]|\s+)/);
            let lineContent = [];
            let currentLineWidth = 0;
            
            for (const part of parts) {
                if (!part) continue;
                
                const placeholderMatch = part.match(/\[([^\]]+)\]/);
                let partWidth;
                
                if (placeholderMatch) {
                    // This is a placeholder - estimate field width
                    const fieldName = placeholderMatch[1];
                    partWidth = Math.max(80, fieldName.length * 7);
                } else {
                    // Regular text - estimate width
                    partWidth = part.length * (fontSize * 0.6);
                }
                
                // Check if adding this part would exceed the line width
                if (currentLineWidth + partWidth > maxWidth && lineContent.length > 0) {
                    // Process current line content
                    const result = await renderLineContent(lineContent, currentPage, pdfDoc, x, currentY, currentFieldCounter);
                    currentFieldCounter = result.fieldCounter;
                    
                    // Move to next line
                    currentY -= lineHeight;
                    
                    // Check if we need a new page
                    if (currentY < 50) {
                        currentPage = pdfDoc.addPage([612, 792]);
                        currentY = currentPage.getSize().height - 50 - fontSize;
                    }
                    
                    // Start new line
                    lineContent = [];
                    currentLineWidth = 0;
                }
                
                // Add part to current line
                if (part.trim() || placeholderMatch) {
                    lineContent.push(part);
                    currentLineWidth += partWidth;
                }
            }
            
            // Process remaining line content
            if (lineContent.length > 0) {
                const result = await renderLineContent(lineContent, currentPage, pdfDoc, x, currentY, currentFieldCounter);
                currentFieldCounter = result.fieldCounter;
            }
            
            // Move to next line for the next input line
            currentY -= lineHeight;
            
            return { 
                yPosition: currentY, 
                fieldCounter: currentFieldCounter,
                currentPage: currentPage 
            };
        }

        async function renderLineContent(lineContent, page, pdfDoc, x, y, fieldCounter) {
            const form = pdfDoc.getForm();
            const fontSize = 12;
            let currentX = x;
            let currentFieldCounter = fieldCounter;
            
            for (const part of lineContent) {
                const placeholderMatch = part.match(/\[([^\]]+)\]/);
                
                if (placeholderMatch) {
                    // This is a placeholder - create a form field
                    const fieldName = placeholderMatch[1];
                    const uniqueFieldName = `${fieldName}_${currentFieldCounter}`;
                    
                    // Calculate field width
                    const fieldWidth = Math.max(80, fieldName.length * 7);
                    
                    // Create text field with no border or background
                    const textField = form.createTextField(uniqueFieldName);
                    textField.addToPage(page, {
                        x: currentX,
                        y: y - 2,
                        width: fieldWidth,
                        height: 16,
                        borderWidth: 0,
                        backgroundColor: PDFLib.rgb(1, 1, 1),
                    });
                    
                    // Set placeholder text as the default value inside the field
                    textField.setText(fieldName);
                    textField.setAlignment(PDFLib.TextAlignment.Left);
                    
                    currentX += fieldWidth;
                    currentFieldCounter++;
                    
                } else if (part.trim()) {
                    // Regular text
                    page.drawText(part, {
                        x: currentX,
                        y: y,
                        size: fontSize,
                        color: PDFLib.rgb(0, 0, 0),
                    });
                    
                    currentX += part.length * (fontSize * 0.6);
                } else {
                    // Space
                    currentX += fontSize * 0.3;
                }
            }
            
            return { fieldCounter: currentFieldCounter };
        }

        // Initialize preview
        updatePreview();
    </script>
</body>
</html>
